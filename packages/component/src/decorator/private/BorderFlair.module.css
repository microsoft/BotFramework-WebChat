@property --webchat-borderFlair-animated-angle {
  syntax: '<number>';
  inherits: true;
  initial-value: 2.35619;
}

@property --webchat-borderFlair-animated-color1 {
  syntax: '<color>';
  inherits: true;
  initial-value: transparent;
}

@property --webchat-borderFlair-animated-color2 {
  syntax: '<color>';
  inherits: true;
  initial-value: transparent;
}

@property --webchat-borderFlair-animated-color3 {
  syntax: '<color>';
  inherits: true;
  initial-value: transparent;
}

@keyframes borderAnimation-angle {
  0% {
    --webchat-borderFlair-animated-angle: 0.75;
  }
  100% {
    --webchat-borderFlair-animated-angle: 2.75;
  }
}

@keyframes borderAnimation-color1 {
  0% {
    --webchat-borderFlair-animated-color1: var(--webchat-borderFlair-color1InOut);
  }
  33% {
    --webchat-borderFlair-animated-color1: var(--webchat-borderFlair-color1);
  }
  83% {
    --webchat-borderFlair-animated-color1: var(--webchat-borderFlair-color1);
  }
  100% {
    --webchat-borderFlair-animated-color1: var(--webchat-borderFlair-color1InOut);
  }
}

@keyframes borderAnimation-color2 {
  0% {
    --webchat-borderFlair-animated-color2: var(--webchat-borderFlair-color2InOut);
  }

  33% {
    --webchat-borderFlair-animated-color2: var(--webchat-borderFlair-color2);
  }

  83% {
    --webchat-borderFlair-animated-color2: var(--webchat-borderFlair-color2);
  }

  100% {
    --webchat-borderFlair-animated-color2: var(--webchat-borderFlair-color2InOut);
  }
}

@keyframes borderAnimation-color3 {
  0% {
    --webchat-borderFlair-animated-color3: var(--webchat-borderFlair-color3InOut);
  }
  33% {
    --webchat-borderFlair-animated-color3: var(--webchat-borderFlair-color3);
  }
  83% {
    --webchat-borderFlair-animated-color3: var(--webchat-borderFlair-color3);
  }
  100% {
    --webchat-borderFlair-animated-color3: var(--webchat-borderFlair-color3InOut);
  }
}

:global(.webchat) .border-flair {
  /* Animation colors */
  --webchat-borderFlair-color1: var(--webchat__border-animation--color-1);
  --webchat-borderFlair-color2: var(--webchat__border-animation--color-2);
  --webchat-borderFlair-color3: var(--webchat__border-animation--color-3);
  --webchat-borderFlair-color1InOut: transparent;
  --webchat-borderFlair-color2InOut: transparent;
  --webchat-borderFlair-color3InOut: transparent;

  position: relative;
  border-radius: inherit;
  animation-duration: 2000ms, 1200ms, 1200ms, 1200ms;
  animation-delay: 0ms, 0ms, 200ms, 400ms;
  animation-timing-function: linear, linear, linear, linear;
  animation-fill-mode: forwards, forwards, forwards, forwards;
  animation-name: borderAnimation-angle, borderAnimation-color1,
    borderAnimation-color2, borderAnimation-color3;

  &::after {
    --webchat-borderFlair-borderSize: 3px;
    --webchat-borderFlair-backgroundSize: calc(100% + (2 * var(--webchat-borderFlair-borderSize)));
    --webchat-borderFlair-borderGradient: linear-gradient(
      calc(var(--webchat-borderFlair-animated-angle) * 180deg + 45deg),
      var(--webchat-borderFlair-animated-color1),
      var(--webchat-borderFlair-animated-color2),
      var(--webchat-borderFlair-animated-color3)
    );

    content: '';
    position: absolute;
    isolation: isolate;
    inset: -1px;
    border-radius: inherit;
    background: var(--webchat-borderFlair-borderGradient) center center / var(--webchat-borderFlair-backgroundSize)
      var(--webchat-borderFlair-backgroundSize);
    border: var(--webchat-borderFlair-borderSize) solid transparent;
    mask: linear-gradient(hsl(0 0% 100% / 0), hsl(0 0% 100% / 0)),
      linear-gradient(hsl(0 0% 100%), hsl(0 0% 100%));
    mask-clip: padding-box, border-box;
    mask-composite: intersect;
    pointer-events: none;
  }
}

/* Firefox implementation */
@supports (-moz-appearance:none) {
  @keyframes borderFlair-animation {
    0% { --webchat-borderFlair-animated: 0.0 }
    1% { --webchat-borderFlair-animated: 0.01 }
    2% { --webchat-borderFlair-animated: 0.02 }
    3% { --webchat-borderFlair-animated: 0.03 }
    4% { --webchat-borderFlair-animated: 0.04 }
    5% { --webchat-borderFlair-animated: 0.05 }
    6% { --webchat-borderFlair-animated: 0.06 }
    7% { --webchat-borderFlair-animated: 0.07 }
    8% { --webchat-borderFlair-animated: 0.08 }
    9% { --webchat-borderFlair-animated: 0.09 }
    10% { --webchat-borderFlair-animated: 0.10 }
    11% { --webchat-borderFlair-animated: 0.11 }
    12% { --webchat-borderFlair-animated: 0.12 }
    13% { --webchat-borderFlair-animated: 0.13 }
    14% { --webchat-borderFlair-animated: 0.14 }
    15% { --webchat-borderFlair-animated: 0.15 }
    16% { --webchat-borderFlair-animated: 0.16 }
    17% { --webchat-borderFlair-animated: 0.17 }
    18% { --webchat-borderFlair-animated: 0.18 }
    19% { --webchat-borderFlair-animated: 0.19 }
    20% { --webchat-borderFlair-animated: 0.20 }
    21% { --webchat-borderFlair-animated: 0.21 }
    22% { --webchat-borderFlair-animated: 0.22 }
    23% { --webchat-borderFlair-animated: 0.23 }
    24% { --webchat-borderFlair-animated: 0.24 }
    25% { --webchat-borderFlair-animated: 0.25 }
    26% { --webchat-borderFlair-animated: 0.26 }
    27% { --webchat-borderFlair-animated: 0.27 }
    28% { --webchat-borderFlair-animated: 0.28 }
    29% { --webchat-borderFlair-animated: 0.29 }
    30% { --webchat-borderFlair-animated: 0.30 }
    31% { --webchat-borderFlair-animated: 0.31 }
    32% { --webchat-borderFlair-animated: 0.32 }
    33% { --webchat-borderFlair-animated: 0.33 }
    34% { --webchat-borderFlair-animated: 0.34 }
    35% { --webchat-borderFlair-animated: 0.35 }
    36% { --webchat-borderFlair-animated: 0.36 }
    37% { --webchat-borderFlair-animated: 0.37 }
    38% { --webchat-borderFlair-animated: 0.38 }
    39% { --webchat-borderFlair-animated: 0.39 }
    40% { --webchat-borderFlair-animated: 0.40 }
    41% { --webchat-borderFlair-animated: 0.41 }
    42% { --webchat-borderFlair-animated: 0.42 }
    43% { --webchat-borderFlair-animated: 0.43 }
    44% { --webchat-borderFlair-animated: 0.44 }
    45% { --webchat-borderFlair-animated: 0.45 }
    46% { --webchat-borderFlair-animated: 0.46 }
    47% { --webchat-borderFlair-animated: 0.47 }
    48% { --webchat-borderFlair-animated: 0.48 }
    49% { --webchat-borderFlair-animated: 0.49 }
    50% { --webchat-borderFlair-animated: 0.50 }
    51% { --webchat-borderFlair-animated: 0.51 }
    52% { --webchat-borderFlair-animated: 0.52 }
    53% { --webchat-borderFlair-animated: 0.53 }
    54% { --webchat-borderFlair-animated: 0.54 }
    55% { --webchat-borderFlair-animated: 0.55 }
    56% { --webchat-borderFlair-animated: 0.56 }
    57% { --webchat-borderFlair-animated: 0.57 }
    58% { --webchat-borderFlair-animated: 0.58 }
    59% { --webchat-borderFlair-animated: 0.59 }
    60% { --webchat-borderFlair-animated: 0.60 }
    61% { --webchat-borderFlair-animated: 0.61 }
    62% { --webchat-borderFlair-animated: 0.62 }
    63% { --webchat-borderFlair-animated: 0.63 }
    64% { --webchat-borderFlair-animated: 0.64 }
    65% { --webchat-borderFlair-animated: 0.65 }
    66% { --webchat-borderFlair-animated: 0.66 }
    67% { --webchat-borderFlair-animated: 0.67 }
    68% { --webchat-borderFlair-animated: 0.68 }
    69% { --webchat-borderFlair-animated: 0.69 }
    70% { --webchat-borderFlair-animated: 0.70 }
    71% { --webchat-borderFlair-animated: 0.71 }
    72% { --webchat-borderFlair-animated: 0.72 }
    73% { --webchat-borderFlair-animated: 0.73 }
    74% { --webchat-borderFlair-animated: 0.74 }
    75% { --webchat-borderFlair-animated: 0.75 }
    76% { --webchat-borderFlair-animated: 0.76 }
    77% { --webchat-borderFlair-animated: 0.77 }
    78% { --webchat-borderFlair-animated: 0.78 }
    79% { --webchat-borderFlair-animated: 0.79 }
    80% { --webchat-borderFlair-animated: 0.80 }
    81% { --webchat-borderFlair-animated: 0.81 }
    82% { --webchat-borderFlair-animated: 0.82 }
    83% { --webchat-borderFlair-animated: 0.83 }
    84% { --webchat-borderFlair-animated: 0.84 }
    85% { --webchat-borderFlair-animated: 0.85 }
    86% { --webchat-borderFlair-animated: 0.86 }
    87% { --webchat-borderFlair-animated: 0.87 }
    88% { --webchat-borderFlair-animated: 0.88 }
    89% { --webchat-borderFlair-animated: 0.89 }
    90% { --webchat-borderFlair-animated: 0.90 }
    91% { --webchat-borderFlair-animated: 0.91 }
    92% { --webchat-borderFlair-animated: 0.92 }
    93% { --webchat-borderFlair-animated: 0.93 }
    94% { --webchat-borderFlair-animated: 0.94 }
    95% { --webchat-borderFlair-animated: 0.95 }
    96% { --webchat-borderFlair-animated: 0.96 }
    97% { --webchat-borderFlair-animated: 0.97 }
    98% { --webchat-borderFlair-animated: 0.98 }
    99% { --webchat-borderFlair-animated: 0.99 }
    100% { --webchat-borderFlair-animated: 1 }
  }

  :global(.webchat) .border-flair {
    animation: borderFlair-animation 2000ms linear forwards;

    --webchat-borderFlair-animated-angle: calc(0.75 + 2 * var(--webchat-borderFlair-animated));
    --webchat-borderFlair-animated-color1: color-mix(in srgb, var(--webchat-borderFlair-color1) calc((1 - abs(var(--webchat-borderFlair-animated) * 3 - 1.5)) * 100%), transparent);
    --webchat-borderFlair-animated-color2: color-mix(in srgb, var(--webchat-borderFlair-color2) calc((1 - abs(var(--webchat-borderFlair-animated) * 3 - 1.75)) * 100%), transparent);
    --webchat-borderFlair-animated-color3: color-mix(in srgb, var(--webchat-borderFlair-color3) calc((1 - abs(var(--webchat-borderFlair-animated) * 3 - 2)) * 100%), transparent);
  }
}
