:global(.webchat-fluent) .activity-decorator {
  display: contents;
}

/* Transcript activity non-empty */
:global(.webchat-fluent) .activity-decorator :global(.webchat__basic-transcript__activity-body:not(:empty)) {
  padding-block-end: var(--webchat-spacingVerticalXL);
}

/* Message bubble text content generated badge */
:global(.webchat-fluent)
  .activity-decorator
  :global(.stacked-layout .webchat__bubble .webchat__text-content__generated-badge) {
  align-items: center;
  align-self: flex-start;
  background-color: var(--webchat-colorNeutralBackground5);
  border-radius: var(--webchat-borderRadiusMedium);
  box-sizing: border-box;
  color: var(--webchat-colorNeutralForeground3);
  cursor: default;
  display: inline-flex;
  font-size: var(--webchat-fontSizeBase100);
  height: 16px;
  line-height: var(--webchat-lineHeightBase100);
  padding-inline: var(--webchat-spacingHorizontalXS);
}

/* Message bubble attachment content */
:global(.webchat-fluent) .activity-decorator :global(.stacked-layout .webchat__bubble .webchat__fileContent__badge) {
  cursor: default;
  font-size: var(--webchat-fontSizeBase300);
  line-height: var(--webchat-lineHeightBase300);

  :global(.webchat__fileContent__fileName) {
    color: var(--webchat-colorBrandForegroundLink);
    font-family: inherit;
  }
  :global(.webchat__fileContent__size) {
    color: var(--webchat-colorNeutralForeground2);
    font-family: inherit;
  }
}

:global(.webchat-fluent)
  .activity-decorator
  :global(.stacked-layout .webchat__bubble .webchat__fileContent__downloadIcon) {
  color: var(--webchat-colorBrandForegroundLink);
}

/* Markdown links and citation links */
:global(.webchat-fluent)
  .activity-decorator
  :global(.webchat__render-markdown)
  a[href]:not(:global(.webchat__render-markdown__pure-identifier)) {
  color: var(--webchat-colorBrandForegroundLink);
  text-decoration-color: transparent;

  &:target {
    color: var(--webchat-colorBrandForegroundLinkSelected);
  }

  &:hover {
    color: var(--webchat-colorBrandForegroundLinkHover);
    text-decoration: underline 1px currentColor;
  }

  &:active {
    color: var(--webchat-colorBrandForegroundLinkPressed);
  }

  &:focus-visible {
    outline: none;
    text-decoration: underline 1px double var(--webchat-colorStrokeFocus2);
  }

  :global(.webchat__render-markdown__external-link-icon) {
    background: currentColor;
    -webkit-mask: var(--webchat__icon-url--external-link) no-repeat;
    mask: var(--webchat__icon-url--external-link) no-repeat;
  }
}

/* Citation inline references */
:global(.webchat-fluent)
  .activity-decorator
  :global(.webchat__render-markdown)
  :global(.webchat__render-markdown__citation),
:global(.webchat-fluent)
  .activity-decorator
  :global(.webchat__render-markdown)
  :global(.webchat__render-markdown__pure-identifier) {
  align-items: center;
  background-color: var(--webchat-colorNeutralBackground3);
  border-radius: var(--webchat-borderRadiusMedium);
  border: var(--webchat-strokeWidthThin) solid var(--webchat-colorNeutralStroke2);
  box-sizing: border-box;
  color: var(--webchat-colorNeutralForeground2);
  display: inline-flex;
  font-size: var(--webchat-fontSizeBase100);
  font-weight: var(--webchat-fontWeightSemibold);
  min-height: 12.4px;
  justify-content: center;
  line-height: 12.4px;
  margin-left: var(--webchat-spacingHorizontalXXS);
  margin-right: var(--webchat-spacingHorizontalXXS);
  min-width: 14px;
  text-decoration: none;
  transition: all var(--webchat-durationNormal) var(--webchat-curveDecelerateMid);
  vertical-align: calc((var(--webchat-lineHeightBase100) - var(--webchat-fontSizeBase100)) / 2);

  &:hover {
    background-color: var(--webchat-colorBrandBackground2Hover);
    border-color: var(--webchat-colorBrandStroke2Hover);
    color: var(--webchat-colorBrandForeground2Hover);
    cursor: pointer;
  }

  &:hover:active {
    background-color: var(--webchat-colorBrandBackground2Pressed);
    border-color: var(--webchat-colorBrandStroke2Pressed);
    color: var(--webchat-colorBrandForeground2Pressed);
  }

  &::before,
  &::after {
    all: unset;
  }

  &:has(:global(.webchat__render-markdown__external-link-icon)) {
    padding-inline: 3px;
  }

  :global(.webchat__render-markdown__external-link-icon) {
    background: currentColor;
    height: 0.7em;
    -webkit-mask: var(--webchat__icon-url--external-link) no-repeat;
    mask: var(--webchat__icon-url--external-link) no-repeat;
  }
}

/* Citation summary chevron */
:global(.webchat-fluent) .activity-decorator :global(.webchat__link-definitions__header) {
  border-radius: var(--webchat-borderRadiusMedium);

  :global(.webchat__link-definitions__header-text) {
    color: var(--webchat-colorNeutralForeground3);
  }

  :global(.webchat__link-definitions__message-sensitivity-label-text) {
    color: var(--webchat-colorNeutralForeground4);
  }

  :global(.webchat__link-definitions__header-chevron) {
    color: var(--webchat-colorNeutralForeground3);
    font-size: var(--webchat__font-size--small);
  }

  &:focus-visible {
    outline-offset: 1px;
    outline: var(--webchat-strokeWidthThin) solid var(--webchat-colorStrokeFocus2);
  }
}

/* Citation link definitions */
:global(.webchat-fluent) .activity-decorator :global(.webchat__link-definitions) {
  --webchat__citation__external-link--mask: var(--webchat-externalLink-mask);
  --webchat__citation__link--max-width: var(--webchat-externalLink-maxWidth);

  :global(.webchat__link-definitions__list) {
    color: var(--webchat__color--subtle);
    display: flex;
    flex-flow: row wrap;
    gap: var(--webchat-spacingHorizontalS);
  }

  :global(.webchat__link-definitions__list-item) {
    border-radius: var(--webchat-borderRadiusMedium);
    max-width: var(--webchat__citation__link--max-width);
  }

  :global(.webchat__link-definitions__list-item-box) {
    background-color: var(--webchat-colorNeutralBackground3);
    border-radius: var(--webchat-borderRadiusMedium);
    border: var(--webchat-strokeWidthThin) solid var(--webchat-colorNeutralStroke2);
    box-sizing: border-box;
    color: currentColor;
    display: inline-flex;
    font-size: var(--webchat__font-size--small);
    height: 24px;
    padding-inline-end: var(--webchat-spacingHorizontalS);
  }

  :global(.webchat__link-definitions__list-item-body) {
    font-family: inherit;
    gap: var(--webchat-spacingHorizontalSNudge);
    min-width: 0;
    padding: 0;
  }

  :global(.webchat__link-definitions__badge) {
    align-self: center;
    background-color: transparent;
    border-radius: 0;
    border: none;
    color: currentColor;
    font-size: var(--webchat-fontSizeBase100);
    font-weight: var(--webchat-fontWeightSemibold);
    line-height: var(--webchat-lineHeightBase100);
    margin: 0;
    min-width: 20px;
    padding: 0;
    position: relative;
    text-align: center;
  }

  :global(.webchat__link-definitions__badge)::after {
    border-right: var(--webchat-strokeWidthThin) solid var(--webchat-colorNeutralStroke2);
    bottom: 0;
    content: '';
    display: block;
    height: 16px;
    position: absolute;
    right: 0;
    top: 0;
    width: 0;
  }

  :global(.webchat__link-definitions__list-item-main-text) {
    gap: var(--webchat-spacingHorizontalXS);
  }

  :global(.webchat__link-definitions__list-item-text) {
    color: currentColor;
    text-decoration: none;
    text-overflow: ellipsis;
  }

  :global(.webchat__link-definitions__list-item-main-text):has(
      :global(.webchat__link-definitions__open-in-new-window-icon)
    )::before {
    align-self: center;
    background: currentColor;
    color: currentColor;
    content: '';
    flex: none;
    font-size: var(--webchat-fontSizeBase400);
    height: 1em;
    -webkit-mask: var(--webchat__citation__external-link--mask) no-repeat;
    mask: var(--webchat__citation__external-link--mask) no-repeat;
    padding: 0;
    width: 1em;
  }

  /* It seems Copilot does not show per-item sensitivity label, i.e. "General", etc. */
  :global(.webchat__link-definitions__list-item-badge) {
    display: none;
  }

  :global(.webchat__link-definitions__open-in-new-window-icon) {
    display: none;
  }
}
