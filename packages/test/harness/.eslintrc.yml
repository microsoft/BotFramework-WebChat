env:
  commonjs: true
  shared-node-browser: true # To support `setTimeout()`

overrides:
  # Files under ./src/browser are running under browser.
  # Files outside, are running under Jest or Node.js.
  - files:
      - ./src/browser/**
    env:
      browser: true

  - files:
      - ./src/host/**
    env:
      jest: true
      node: true
    plugins:
      - node
    extends:
      - plugin:node/recommended
    rules:
      node/callback-return: error
      node/global-require: error
      node/handle-callback-err: error
      node/no-missing-import:
        - error
        - tryExtensions:
            - '.js'
            - '.json'
            - '.node'
            - '.ts'
      node/no-mixed-requires: error
      node/no-new-require: error
      node/no-path-concat: error
      node/no-sync: error
      node/no-unpublished-import: error
      node/no-unpublished-require:
        - error
        # The following packages did not publish any exports.
        - allowModules:
            - express
            - global-agent
            - http-proxy-middleware
            - istanbul-lib-coverage
            - jest-environment-node
            - jest-image-snapshot
            - node-fetch
            - p-defer-es5
            - selenium-webdriver
            - strip-ansi
      node/prefer-global/buffer: error

rules:
  # Jest does not support ESM yet.
  '@typescript-eslint/no-var-requires': off

  # We might dump test result to console.
  no-console: off
